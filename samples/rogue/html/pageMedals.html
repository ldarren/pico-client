<style>
#medals{
    background:#527f39;
}
.medal{
    background:#204631;
    border-top:#527f39 5px solid;
}
.medal img{
    display:inline-block;
    padding:5px;
    vertical-align:top;
    max-width:128px;
    width:20%;
}
.medal div{
    display:inline-block;
    padding:5px;
    vertical-align:top;
    width:70%;
}
.medal h4{
}
.medal p{
    padding: 5px 0;
}
.medal span:nth-of-type(1){
    display:block;
}
.medal span:nth-of-type(2){
    display:block;
}
</style>

<div class=pageHead>
<a href=#>&lt;&lt;</a>
<span>Medals</span>
</div>

<div id=medals>
</div>

<script id=medalTempl type=text/templ>
<img src="dat/img/medals/FNAME.png">
<div>
<h4>NAME (UNLOCK/3)</h4>
<p>DESC</p>
<span>Next unlock: CURR/TOTAL</span>
<span>Unlock rewards: REWARD</span>
</div>
</script>

<script name=medalPage>
var
me = this,
medalList = [
'won', 'die', 'gold', 'piety', 'fame', 'plant','chest', 'common', 'charm', 'enchant', 'legendary', 'drink', 'learn', 
'insect', 'beast', 'undead', 'demon', 'def', 'patk', 'ratk', 'will', 'cast', 
'burn', 'curse', 'plague', 'fear', 'frozen', 'poison'],
onBack = function(evt){
    var hash = window.location.hash;
    if (!hash || '#me' === hash) pico.changeFrame(document.body, 'div#page', 'html/pageLogin.html', {opacity:[0,1,'1s']});
    else pico.changeFrame(document.body, 'div#page', 'html/pageMap.html', {opacity:[0,1,'1s']});
},
onLoad = function(){
    var 
    socials = me.socials,
    god = me.god,
    id = window.location.hash.substring(1),
    backBtn = document.querySelector('div.pageHead a'),
    medalCont = document.querySelector('div#medals'),
    templ = document.querySelector('script#medalTempl').textContent,
    medalId,medalEle,medalLevel;

    backBtn.addEventListener('click', onBack);

    medalCont.innerHTML = '';

    socials.readMedals(id ? id : 'me', function(medals){
        for(var i=0,l=medalList.length; i<l; i++){
            medalId = medalList[i];
            medalLevel = medals[medalId] || 0;
            medalEle = document.createElement('div');
            medalEle.className = 'medal';
            medalEle.innerHTML = templ
                                    .replace('FNAME', medalId+'-'+medalLevel)
                                    .replace('UNLOCK', medalLevel)
                                    .replace('NAME', G_MEDAL_GRADE[medalLevel] + G_MEDAL_NAME[medalId])
                                    .replace('DESC', G_MEDAL_DESC[medalId])
                                    .replace('CURR', god.getProgress(medalId))
                                    .replace('TOTAL', socials.getMedalTarget(medalId, medalLevel))
                                    .replace('REWARD', socials.getMedalReward(medalId, medalLevel)+' Piety points');
            medalCont.appendChild(medalEle);
        }
    });
};

me.use('socials');
me.use('god');

me.slot(pico.LOAD, onLoad);
</script>
