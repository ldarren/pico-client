<style>
.fb-connect {
    background:url(css/fb_white_29.png) no-repeat 5px 5px #3b579d;
    display:block;
    line-height:39px;
    outline:medium none;
    text-decoration:none;
    border-radius: 2px 2px;
}
.fb-connect span {
    color:#fff;
    cursor:pointer;
    display:block;
    font-size:14px;
    font-weight:bold;
    margin: 0 0 0 39px;
    width:161px;
    text-height:39px;
    text-align:center;
    font-family: 'Helvetica Neue',Helvetica,Arial, 'lucida grande',tahoma,verdana,arial,sans-serif;
}
.fb-connect:active {background-color:#29447e;}

.goog-connect {
    background:url(css/goog_white_32.png) no-repeat 4px 3px #dd4b39;
    display:block;
    line-height:39px;
    outline:medium none;
    text-decoration:none;
    border-radius: 2px 2px;
}
.goog-connect span {
    color:#fff;
    cursor:pointer;
    display:block;
    font-size:14px;
    font-weight:bold;
    border-left: #be3f2b solid 1px;
    margin:0 0 0 39px;
    width:168px;
    text-height:39px;
    text-align:center;
    font-family: 'Helvetica Neue', Helvetica, Arial, 'lucida grande',tahoma,verdana,arial,sans-serif;
}
.goog-connect:active {background-color:#c03d28;}
.goog-connect:active span{border-left: #a43422 solid 1px;}

.hidden{ display:none;}
.shown{ display:block;}

.frame{
    max-width: 512px;
    color:#aec440;
    border: 3px solid #d7e894;
    border-radius: 15px;
    margin:5px auto;
    padding:5px 0 5px 0;
    display:block;
}
.frame h4{
    margin: 0 auto 10px auto;
    text-align:center;
    line-height:20px;
}
.frame div{
    width:200px;
    margin: 10px auto;
}
.frame input[type=text]{
    box-sizing: border-box;
    -webkit-box-sizing: border-box;
    line-height:30px;
    text-align:center;
    width:100%;
    height:30px;
}
.frame input[type=checkbox]{
    margin: 0 5px 0 0;
}
</style>

<h3>Dungeon Chronicles</h3>

<div id=gameInfo class=frame>
<h4>Game Info</h4>
<div><a href=# class=fantasyBtn>Connecting...</a></div>
<div><a href=# class=hidden><span>Log In</span></a></div>
<div><input class=hidden type=text placeholder="Hero Name: Nameless"></input></div>
<div><input type=checkbox>Silence</input></div>
<div><a href=# class=hidden>Dungeon Map</a></div>
<div><a href=# class=hidden>Medals</a></div>
</div>

<div id=cloudSave class=hidden>
<h4>Cloud Save</h4>
<div><a href=# class=goog-connect><span>Sign In</span></a></div>
</div>

<div id=encyclopedia class=frame>
<h4>Encyclopedia</h4>
<div><a href=# class=fantasyBtn>Heroes</a></div>
<div><a href=# class=fantasyBtn>Creeps</a></div>
<div><a href=# class=fantasyBtn>Skills</a></div>
<div><a href=# class=fantasyBtn>Status Effects</a></div>
</div>

<script name=loginPage>
this.use('rogueMain');
this.use('piHTMLAudio');
this.use('socials');
this.use('game');

var
me = this,
playBtn, fbBtn, gpBtn, nameTextbox, audioSwitch, mapBtn, medalBtn,
onPlay = function(){
    me.piHTMLAudio.preload();
    me.piHTMLAudio.volume(audioSwitch.checked ? 0 : 1);
    me.rogueMain.showLoading();
    me.game.init(nameTextbox.value || 'Nameless');
    pico.changeFrame(document.body, 'div#page', 'html/pageGame.html', {opacity:[0,1,'1s']});
},
onLogin = function(evt){
    me.socials.fbLogin({scope:'publish_actions'});
},
onShowMap = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageMap.html', {opacity:[0,1,'1s']});
},
onShowMedals = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageMedals.html', {opacity:[0,1,'1s']});
},
onShowHeroes = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageHeroes.html', {opacity:[0,1,'1s']});
},
onShowCreeps = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageCreeps.html', {opacity:[0,1,'1s']});
},
onShowSkills = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageSkills.html', {opacity:[0,1,'1s']});
},
onShowEffects = function(evt){
    pico.changeFrame(document.body, 'div#page', 'html/pageEffects.html', {opacity:[0,1,'1s']});
},
fbUpdate = function(){
    var socials = me.socials;

    socials.loadNPCs(function(npcs){
        mapBtn.removeEventListener('click', onShowMap);
        medalBtn.removeEventListener('click', onShowMedals);
        socials.loadAllies(function(friends){
            mapBtn.className = 'fantasyBtn';
            mapBtn.addEventListener('click', onShowMap, false);

            medalBtn.className = 'fantasyBtn';
            medalBtn.addEventListener('click', onShowMedals, false);
        });
    });
},
onFacebookUpdate = function(userId){
    fbBtn.removeEventListener('click', onLogin);
    playBtn.removeEventListener('click', onPlay);
    var cloudSave = document.querySelector('div#cloudSave');
    if (userId){
        playBtn.textContent = 'Begin';

        fbBtn.className = 'hidden';
        playBtn.className = 'fantasyBtn';
        nameTextbox.removeAttribute('class');
        cloudSave.className = 'frame';
        fbUpdate();
        playBtn.addEventListener('click', onPlay, false);
    }else{
        playBtn.className = 'hidden';
        fbBtn.className = 'fb-connect';
        nameTextbox.className = 'hidden';
        cloudSave.className = 'hidden';
        fbBtn.addEventListener('click', onLogin, false);
    }
},
onLoad = function(){
    var frame = document.querySelector('div#gameInfo');
    playBtn = frame.children[1].children[0];
    fbBtn = frame.children[2].children[0];
    nameTextbox = frame.children[3].children[0];
    audioSwitch = frame.children[4].children[0];
    mapBtn = frame.children[5].children[0];
    medalBtn = frame.children[6].children[0];

    frame = document.querySelector('div#encyclopedia');
    var btn = frame.children[1].children[0];
    btn.addEventListener('click', onShowHeroes, false);
    btn = frame.children[2].children[0];
    btn.addEventListener('click', onShowCreeps, false);
    btn = frame.children[3].children[0];
    btn.addEventListener('click', onShowSkills, false);
    btn = frame.children[4].children[0];
    btn.addEventListener('click', onShowEffects, false);

    var name = me.game.load();
    if (name){
      nameTextbox.value = name;
    }

    me.piHTMLAudio.create('dat/fantasy-sfx.json', function(err, audioSprite){
        me.socials.fbInit(
            '515256841901768', 
            'Phonegap' === pico.states.browser ? CDV.FB : '//dungeon-chronicles.com/rogue/html/fbChannel.html',
            onFacebookUpdate);
        /* if no network */ me.rogueMain.hideLoading();
    });
};

me.slot(pico.LOAD, onLoad);
</script>
