<style>
.cssBtn {
    position:relative;
    -moz-box-shadow:inset 0px 1px 0px 0px #caefab;
    -webkit-box-shadow:inset 0px 1px 0px 0px #caefab;
    box-shadow:inset 0px 1px 0px 0px #caefab;
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #77d42a), color-stop(1, #5cb811) );
    background:-moz-linear-gradient( center top, #77d42a 5%, #5cb811 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#77d42a', endColorstr='#5cb811');
    background-color:#77d42a;
    -webkit-border-top-left-radius:0px;
    -moz-border-radius-topleft:0px;
    border-top-left-radius:0px;
    -webkit-border-top-right-radius:0px;
    -moz-border-radius-topright:0px;
    border-top-right-radius:0px;
    -webkit-border-bottom-right-radius:0px;
    -moz-border-radius-bottomright:0px;
    border-bottom-right-radius:0px;
    -webkit-border-bottom-left-radius:0px;
    -moz-border-radius-bottomleft:0px;
    border-bottom-left-radius:0px;
    text-indent:0;
    border:1px solid #268a16;
    display:inline-block;
    color:#306108;
    font-family:alagard, Arial;
    font-size:15px;
    font-weight:normal;
    font-style:normal;
    height:40px;
    line-height:40px;
    width:200px;
    text-decoration:none;
    text-align:center;
    text-shadow:1px 1px 0px #aade7c;
}
.cssBtn:hover {
    background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #5cb811), color-stop(1, #77d42a) );
    background:-moz-linear-gradient( center top, #5cb811 5%, #77d42a 100% );
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#5cb811', endColorstr='#77d42a');
    background-color:#5cb811;
}
.cssBtn:active {top:1px;}

.fb-connect {
    background:url(css/fb_white_29.png) no-repeat 5px 5px #3b579d;
    display:none;
    line-height:32px;
    outline:medium none;
    padding:0 0 0 1px;
    text-decoration:none;
    border-radius: 2px 2px;
}
.fb-connect span {
    color:#fff;
    cursor:pointer;
    display:block;
    font-size:14px;
    font-weight:bold;
    margin:1px 1px 0 38px;
    padding:2px 57px 3px;
    font-family: 'Helvetica Neue',Helvetica,Arial, 'lucida grande',tahoma,verdana,arial,sans-serif;
}
.fb-connect:active {background-color:#29447e;}

.goog-connect {
    background:url(css/goog_white_32.png) no-repeat 4px 3px #dd4b39;
    display:block;
    line-height:32px;
    outline:medium none;
    padding:0 0 0 1px;
    text-decoration:none;
    border-radius: 2px 2px;
}
.goog-connect span {
    color:#fff;
    cursor:pointer;
    display:block;
    font-size:14px;
    font-weight:bold;
    border-left: #be3f2b solid 1px;
    margin:1px 1px 0 38px;
    padding:2px 54px 3px;
    font-family: 'Helvetica Neue', Helvetica, Arial, 'lucida grande',tahoma,verdana,arial,sans-serif;
}
.goog-connect:active {background-color:#c03d28;}
.goog-connect:active span{border-left: #a43422 solid 1px;}

h3{
    margin: 10px auto;
    text-align:center;
    line-height:50px;
}
h4{
    margin: 0 auto 10px auto;
    text-align:center;
    line-height:20px;
}
ul.mainMenu{
    width:200px;
    margin: 10px auto;
}
ul.mainMenu li{
    display: block;
    list-style: none;
    margin: 10px auto;
}
ul.mainMenu li input[type=text]{
    line-height:30px;
    text-align:center;
    width:100%;
    height:30px;
}
.frame{
    max-width: 512px;
    color:#aec440;
    border: 3px solid #d7e894;
    border-radius: 15px;
    margin:5px auto;
    padding:5px 0 5px 0;
    display:none;
}
.frame div{
    width:200px;
    margin: 10px auto;
}
content.fbProfileList{
}
span.fbProfileRow{
    display:block;
    min-height:100px;
    white-space:nowrap;
    overflow:auto;
}
div.fbProfile{
    display:inline-block;
    vertical-align:top;
    width: 90px;
    padding:5px;
}
div.fbProfile img{
    display:block;
    margin: 0 auto;
}
div.fbProfile span{
    display:block;
    text-align: center;
    padding:3px;
}
</style>

<div id=fb-root></div>

<h3>Dungeon Chronicles</h3>

<ul class=mainMenu>
<li><a href=# class=cssBtn>Connecting...</a></li>
<li><a href=# class=fb-connect><span>Log In</span></a></li>
<li><input type=text placeholder="Hero Name: Nameless"></input></li>
<li><input type=checkbox>Silence</input></li>
</ul>

<div id=ranking class="frame fantasyBg">
<h4>Dungeon Map</h4>
<content class=fbProfileList></content>
</div>

<div id=badges class=frame>
<h4>Achievements</h4>
<span></span>
</div>

<div id=deviceSync class=frame>
<h4>Cloud Save</h4>
<div><a href=# class=goog-connect><span>Sign In</span></a></div>
</div>

<script id=fbBadge type=text/templ>
<img src="https://graph.facebook.com/USER_ID/picture">
<span>NAME</span>
</script>

<script id=fbScoreRow type=text/templ>
</script>

<script id=fbProfile type=text/templ>
<img src=PROFILE>
<span>NAME</span>
</script>

<script name=loginPage>
this.use('rogueMain');
this.use('piHTMLAudio');
this.use('socials');
this.use('game');

var
me = this,
playBtn, fbBtn, gpBtn, nameTextbox, 
onPlay = function(){
    me.piHTMLAudio.preload();
    me.rogueMain.showLoading();
    me.game.init(nameTextbox.value || 'Nameless');
    pico.changeFrame(document.body, 'div#page', 'html/pageGame.html', {opacity:[0,1,'1s']});
},
onLogin = function(evt){
    me.socials.fbLogin({scope:'publish_actions,user_games_activity'});
},
fbUpdate = function(){
    var
    socials = me.socials,
    frames = document.getElementsByClassName('frame');

    for (var i=0,l=frames.length; i<l; i++){
        frames[i].style.display = 'block';
    }
    socials.loadNPCs(function(npcs){
        var list = document.querySelector('content.fbProfileList');
        if (!list) return;
        list.innerHTML = '';
        var templ = document.querySelector('script#fbProfile').textContent;
        socials.loadAllies(function(friends){
            var deepest, currLevel, level, row, profile, friend, label;

            for(var i=0,l=friends.length; i<l; i++){
                friend = friends[i];
                for(deepest = list.children.length || 0, currLevel = friend[2]; deepest < currLevel; deepest++){
                    level = document.createElement('span');
                    level.className = 'fantasyRow';

                    row = document.createElement('span');
                    row.className = 'fbProfileRow';
                    level.appendChild(row);

                    label = document.createElement('h5');
                    label.textContent = 'Level '+(deepest+1);
                    level.appendChild(label);

                    list.appendChild(level);
                }
                row = list.querySelector('span:nth-child('+currLevel+') span');
                profile = document.createElement('div');
                profile.className = 'fbProfile';
                profile.innerHTML = templ
                    .replace('PROFILE', socials.fbProfile(friend[0], 42))
                    .replace('NAME', friend[1].split(' ')[0]);
                row.appendChild(profile);
            }
        });
    });
},
onFacebookUpdate = function(userId){
    fbBtn.removeEventListener('click', onLogin);
    playBtn.removeEventListener('click', onPlay);
    if (userId){
        fbBtn.style.display = 'none';
        playBtn.style.display = 'block';
        playBtn.textContent = 'Begin';
        fbUpdate();
        playBtn.addEventListener('click', onPlay, false);
    }else{
        playBtn.style.display = 'none';
        fbBtn.style.display = 'inline-block';
        fbBtn.addEventListener('click', onLogin, false);
    }
},
onLoad = function(){
    playBtn = document.querySelector('ul.mainMenu li:nth-child(1) a');
    fbBtn = document.querySelector('ul.mainMenu li:nth-child(2) a');
    nameTextbox = document.querySelector('ul.mainMenu li:nth-child(3) input');

    var name = me.game.load();
    if (name){
      nameTextbox.value = name;
    }

    me.piHTMLAudio.create('dat/fantasy-sfx.json', function(err, audioSprite){
        me.socials.fbInit(
            '515256841901768', 
            'Phonegap' === pico.states.browser ? CDV.FB : '//dungeon-chronicles.com/rogue/html/fbChannel.html',
            onFacebookUpdate);
        /* if no network */ me.rogueMain.hideLoading();
    });
};

me.slot(pico.LOAD, onLoad);
</script>
