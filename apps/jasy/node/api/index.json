{
    "deps":{
        "util":"api/util",
        "user":"api/user",
        "email":"api/email",
        "entity":"api/entity",
        "directory":"api/directory",
		"stream":"api/stream",
		"remote":"api/remote",
        "web":["context","webServer"]
    },      
    "routes":{
        "/jasy":[
            ["util","route","req"],
			["web","parse","req","res"]
        ],
		"/jasy/stream":[
			["web","SSEStart","req","res"],
            ["user","verify","cred",["$grp","$cwd"]],
			["stream","prepare","cred","input","output"],
			["user","poll","input","output"],
			["directory","poll","cred","input",":poll","output"],
			["directory","last","cred","input","$grp",":poll","output"],
			["directory","replyStream","$grp","output"],
			["entity","last","cred","input",":poll","output"],
			["stream","add","res","cred"],
			["stream","render","res",["poll"],"output"]
		],
		"0 0 * * * *":[
			["user","rotate"]
		],
		"*/5 * * * * *":[
			["remote","trigger"]
		],
		"ERR//jasy/stream":[
			["stream","render","res",["error"],"error"],
			["stream","remove","res"]
		],
        "ERR|#msg": [
			["util","logParams"],
            []
        ],
        "END|#msg": [
            [] 
        ],
		"from/remote/user/read":[
            ["util","have","input",[["id"]]],
			["entity","findId","cred",["$entId"]],
			["entity","getMapAll","$entId","ent"],
			["remote","verify","cred","ent"],
			["user","read","input","user"],
			["user","reply","user"],
			[]
		],
		"from/remote/directory/create":[
            ["util","have","input",[["name"]]],
			["entity","findId","cred",["$entId"]],
			["entity","getMapAll","$entId","ent"],
			["remote","verify","cred","ent"],
			["util","read","ent",["home","$grp"]],
			["util","read","cred",["cwd","$wd"]],
			["directory","join","$grp","$wd",["$cwd"]],
			["directory","find","$cwd","dir"],
            ["directory","role","cred","dir",[["root","admin"]]],
			["util","read","input",["name","$name"]],
            ["directory","newGroup","cred","$cwd","$name","newdir"],
			["directory","read","newdir"],
            ["directory","replyPrivate","$grp","newdir"],
			[]
		],
		"from/remote/directory/list":[
            ["util","have","input",[["grp","name"]]],
			["entity","findId","cred",["$entId"]],
			["entity","getMapAll","$entId","ent"],
			["remote","verify","cred","ent"],
			["util","read","ent",["home","$grp"]],
			["util","read","input",["grp","$ngrp"]],
			["util","read","input",["name","$name"]],
			["directory","join","$grp","$ngrp","$name",["$wd"]],
			["directory","listMine","cred","$wd",":dirs"],
            ["directory","replyList","$grp",":dirs"],
			[]
		],
		"from/remote/directory/search":[
            ["util","have","input",[["grp"]]],
			["entity","findId","cred",["$entId"]],
			["entity","getMapAll","$entId","ent"],
			["remote","verify","cred","ent"],
			["util","read","ent",["home","$grp"]],
			["util","read","input",["grp","$ngrp"]],
			["directory","join","$grp","$ngrp",["$wd"]],
			["directory","search","$wd",":dirs"],
            ["directory","replyList","$grp",":dirs"],
			[]
		],
		"from/remote/group/list":[
            ["util","have","input",[["id"]]],
			["entity","findId","cred",["$entId"]],
			["entity","getMapAll","$entId","ent"],
			["remote","verify","cred","ent"],
			["directory","group","input"],
            ["directory","output","input"],
			[]
		],
		"session.remote":[
			["entity","read","$entId","ent"],
			["remote","getSession","ent","user",["$sessKey"]],
            ["user","createSession","cred","user","$sessKey","session"],
            ["user","replyPrivate","session"],
            []
		],
		"session.local":[
            ["util","randomStr",["$sessKey",20]],
            ["user","createSession","cred","user","$sessKey","session"],
            ["user","storeSession","$entId","$grp","session"],
            ["user","replyPrivate","session"],
            []
		],
        "jasy/email/signup":[
            ["util","have","input",[["email","pwd"]]],
            ["email","verifyEmail","input",[null]],
            ["util","randomStr",["$verifyId",20]],
			["entity","findId","cred",["$entId"]],
			["entity","getMap","$entId",["name","$appName"]],
            ["email","sendConfirmation","cred","input","$appName","$verifyId","output"],
            ["user","replyPrivate","output"],
            []
        ],
        "jasy/email/confirm":[
            ["util","have","input",[["email","verifyId"]]],
            ["email","verifyEmail","input",[null]],
            ["email","confirmation","cred","input","user"],
            ["user","create","cred","user"],
			["entity","findAPIId","cred",["$entId"]],
			["entity","getMap","$entId",["home","$grp"]],
			["entity","branch","$entId",["session"]]
        ],
        "jasy/email/signin":[
            ["util","have","input",[["email","pwd"]]],
            ["email","verifyEmail","input","user"],
            ["email","verifyPwd","input","user"],
			["entity","findAPIId","cred",["$entId"]],
			["entity","getMap","$entId",["home","$grp"]],
			["entity","branch","$entId",["session"]]
        ],
        "jasy/email/update":[
            ["user","verify","cred",["$grp","$cwd"]],
            ["email","update","cred","input","output"],
            ["user","replyPrivate","output"],
            []
        ],
        "jasy/user/signout":[
            ["user","verify","cred",["$grp","$cwd"]],
            ["user","removeSession","cred"],
            []
        ],
        "jasy/user/update":[
            ["user","verify","cred",["$grp","$cwd"]],
            ["user","update","cred","input","output"],
            ["user","replyPrivate","output"],
            []
        ],
        "jasy/user/list":[
            ["user","verify","cred",["$grp","$cwd"]],
            ["user","list","input",":output"],
            ["user","replyList",":output"],
            []
        ],
        "jasy/user/read":[
            ["util","have","input",[["id"]]],
            ["user","verify","cred",["$grp","$cwd"]],
            ["user","read","input","output"],
            ["user","reply","output"],
            []
        ],
        "jasy/entity/create":[
            ["util","have","input",[["name","type"]]],
            ["user","verify","cred",["$grp","$cwd"]],
			["directory","find","$cwd","dir"],
            ["directory","role","cred","dir",[["root","admin"]]],
            ["entity","uuid","cred","input",["$key"]],
            ["util","randomStr",["$secret",40]],
            ["entity","create","cred","input","$cwd","$key","$secret","entity"],
            ["directory","newGroup","cred","$cwd","$key","dir"],
            ["directory","linkEntity","cred","dir","entity"],
            ["entity","replyPrivate","entity"],
            []
        ],
		"jasy/group/list":[
            ["util","have","input",[["id"]]],
            ["user","verify","cred",["$grp","$cwd"]],
			["directory","group","input"],
            ["directory","output","input"],
			[]
		],
		"jasy/directory/create":[
            ["util","have","input",[["name"]]],
            ["user","verify","cred",["$grp","$cwd"]],
			["directory","find","$cwd","dir"],
            ["directory","role","cred","dir",[["root","admin"]]],
			["util","read","input",["name","$name"]],
            ["directory","newGroup","cred","$cwd","$name","newdir"],
			["directory","read","newdir"],
            ["directory","replyPrivate","$grp","newdir"],
			[]
		],
		"jasy/directory/join":[
            ["user","verify","cred",["$grp","$cwd"]],
			["directory","find","$cwd","dir"],
            ["directory","userJoin","cred","dir","input"],
			[]
		],
        "#help": [
            ["util","help"] 
        ] 
    }
}   
